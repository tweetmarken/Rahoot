(this.webpackJsonpcahoots=this.webpackJsonpcahoots||[]).push([[0],{107:function(e,t,a){e.exports={hero_heading:"styles_hero_heading__1odbt"}},108:function(e,t,a){e.exports=a(257)},113:function(e,t,a){},115:function(e,t,a){},257:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(38),s=a.n(c),l=(a(113),a(14)),u=a(19),i=(a(114),a(115),a(6)),o=a(258),m=a(259),d=a(260),f=a(261),h=a(262),g=a(10),E=a.n(g),b=a(22),p=a(103),v=a(104),y=a(61),w=a.n(y),O=function(){function e(t){var a=t.gameId;Object(p.a)(this,e);var n=JSON.parse(atob(a)),r=n.apiKey,c=n.baseId;w.a.configure({endpointUrl:"https://api.airtable.com",apiKey:r}),this.game=w.a.base(c),this.getAllQuestions=this.getAllQuestions.bind(this),this.startNextQuestion=this.startNextQuestion.bind(this),this.getCurrentQuestion=this.getCurrentQuestion.bind(this)}return Object(v.a)(e,[{key:"addPlayer",value:function(e){return this.game("Players").create({Name:e}).then((function(e){return e.getId()}))}},{key:"getPlayer",value:function(e){return this.game("Players").find(e)}},{key:"getPlayers",value:function(){return this.game("Players").select().all()}},{key:"addAnswer",value:function(){var e=Object(b.a)(E.a.mark((function e(t,a){var n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCurrentQuestion();case 2:if(void 0!==(n=e.sent)){e.next=5;break}throw new Error("Question has not started!");case 5:return e.abrupt("return",this.game("Answers").create({Answer:a,Player:[t],Question:[n.getId()]}).then((function(e){return{answer:e,question:n}})));case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getQuestion",value:function(e){return this.game("Questions").find(e)}},{key:"getAllQuestions",value:function(){return this.game("Questions").select({sort:[{field:"Order",direction:"asc"}]}).all()}},{key:"getAnswers",value:function(){var e=Object(b.a)(E.a.mark((function e(t){var a,n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.game("Questions").find(t).then((function(e){return e.get("Answers")}));case 2:return void 0===(a=e.sent)&&(a=[]),n="OR(".concat(a.map((function(e){return'RECORD_ID()="'.concat(e,'"')})).join(","),")"),e.abrupt("return",this.game("Answers").select({filterByFormula:n}).all());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startNextQuestion",value:function(){var e=Object(b.a)(E.a.mark((function e(){var t,a,n,r,c,s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.game("Questions").select({filterByFormula:"{Finished At} = BLANK()",maxRecords:1,sort:[{field:"Order",direction:"asc"}]}).firstPage();case 2:if(t=e.sent,void 0!==(a=t[0])){e.next=6;break}return e.abrupt("return");case 6:return n=new Date(Date.now()+2e4),e.next=9,this.game("Questions").update([{id:a.id,fields:{"Finished At":"".concat(n.toISOString())}}]);case 9:return r=e.sent,c=Object(i.a)(r,2),s=c[1],e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentQuestion",value:function(){var e=Object(b.a)(E.a.mark((function e(){var t;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.next=3,this.getAllQuestions().then((function(e){t=e.find((function(e){return(e.get("Finished At")?new Date(e.get("Finished At")):new Date+1)>new Date}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),j=function(e){var t=e.playerName,a=e.setPlayerName,n=e.joinGame;return r.a.createElement("div",null,r.a.createElement(o.a,null,r.a.createElement(m.a,null,"Name:"),r.a.createElement(d.a,{value:t,onChange:function(e){return a(e.target.value)}})),r.a.createElement(f.a,{color:"primary",onClick:n},"JOIN"))},N=function(e){var t=Object(u.g)().gameId,a=Object(n.useState)(""),c=Object(i.a)(a,2),s=c[0],l=c[1],o=Object(n.useState)(""),m=Object(i.a)(o,2),d=m[0],f=m[1],g=new O({gameId:t});return r.a.createElement(h.a,{style:{maxWidth:"500px"}},d?r.a.createElement(u.a,{to:"/games/".concat(t,"/players/").concat(d)}):r.a.createElement(j,{playerName:s,setPlayerName:l,joinGame:function(){g.addPlayer(s).then(f)}}))},I=a(263),A=a(264),x=a(270),k=function(e){var t=(e-Date.now())/1e3;return t>0?t:0},Q=function(e){var t=e.till,a=e.className,c=Object(n.useState)(k(t)),s=Object(i.a)(c,2),l=s[0],u=s[1];return setTimeout((function(){return u(k(t))}),1e3),r.a.createElement("div",{className:a},l>0?Math.floor(l):0," seconds left")},C=function(e){var t=e.recordAnswer;return r.a.createElement(I.a,null,["A","B","C","D"].map((function(e){return r.a.createElement(A.a,{sm:12,md:6,className:"mb-4",key:e},r.a.createElement(f.a,{className:"w-100 h-100",onClick:function(){return t(e)}},r.a.createElement("strong",null,e)))})))},S=function(e){var t=Object(u.g)(),a=t.gameId,c=t.playerId,s=Object(n.useState)(""),l=Object(i.a)(s,2),o=l[0],m=l[1],d=Object(n.useState)(null),f=Object(i.a)(d,2),g=f[0],E=f[1],b=Object(n.useState)(""),p=Object(i.a)(b,2),v=p[0],y=p[1],w=new O({gameId:a});Object(n.useEffect)((function(){w.getPlayer(c).then((function(e){return m(e.get("Name"))}))}),[]);return r.a.createElement(h.a,{style:{maxWidth:"500px"}},r.a.createElement(I.a,{className:"mb-4"},r.a.createElement(A.a,{sm:12},r.a.createElement("h2",null,"Hi ",o,"!"),r.a.createElement("h3",null,"Choose your answer:"))),r.a.createElement(C,{recordAnswer:function(e){w.addAnswer(c,e).then((function(e){var t=e.question;E(t),y("")})).catch((function(e){y(e),setTimeout((function(){return y("")}),5e3)}))}}),g?r.a.createElement(Q,{till:new Date(g.get("Finished At"))}):null,v?r.a.createElement(x.a,{color:"danger"},v):null)},P=a(265),D=a(107),R=a.n(D),B=function(e,t){return window.btoa(JSON.stringify({apiKey:e,baseId:t}))},K=function(e){var t=e.apiKey,a=e.baseId,n=B(t,a);return r.a.createElement(o.a,null,r.a.createElement(m.a,null,"Join URL:"),r.a.createElement(d.a,{disabled:!0,placeholder:"Enter an API Key and Base ID to generate the URL",value:t&&a?"".concat(window.location,"games/").concat(encodeURI(n),"/join"):null}))},q=function(e){var t=Object(n.useState)(""),a=Object(i.a)(t,2),c=a[0],s=a[1],u=Object(n.useState)(""),g=Object(i.a)(u,2),E=g[0],b=g[1],p=B(c,E);return r.a.createElement(h.a,{style:{maxWidth:"500px"}},r.a.createElement("h1",{className:R.a.hero_heading},"Cahoots!"),r.a.createElement(P.a,{className:"mb-5"},r.a.createElement(o.a,null,r.a.createElement(m.a,{for:"apiKey"},"API Key:"),r.a.createElement(d.a,{id:"apiKey",value:c,onChange:function(e){return s(e.target.value)}})),r.a.createElement(o.a,null,r.a.createElement(m.a,null,"Base ID:"),r.a.createElement(d.a,{value:E,onChange:function(e){return b(e.target.value)}})),r.a.createElement(K,{apiKey:c,baseId:E})),r.a.createElement(l.b,{to:"/games/".concat(encodeURI(p),"/questions/current")},r.a.createElement(f.a,{color:"primary"},"Start Game")))},F=a(266),U=a(267),_=a(268),J=a(269),W=function(e){var t=e.result,a=e.className,n=e.question;return r.a.createElement("div",{className:a},r.a.createElement("h2",{className:"mb-4"},n?n.get("Name"):null),r.a.createElement(I.a,null,Object.entries(t).map((function(e){var t=Object(i.a)(e,2),a=t[0],c=t[1];return r.a.createElement(A.a,{sm:12,md:6,className:"mb-4"},r.a.createElement(F.a,{color:n.get("Correct Answer")==a?"success":null,inverse:n.get("Correct Answer")==a||null},r.a.createElement(U.a,null,r.a.createElement(_.a,null,r.a.createElement("strong",{className:"mr-2"},a),n.get("Correct Answer")==a?"\u2714\ufe0f":"\u274c"),r.a.createElement(J.a,null,c.join(", ")))))}))))};function L(){return(L=Object(b.a)(E.a.mark((function e(t,a){var n,r,c;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAnswers(a);case 2:return n=e.sent,e.next=5,t.getPlayers();case 5:return r=e.sent,c={A:[],B:[],C:[],D:[]},n.forEach((function(e){var t=e.get("Answer"),a=e.get("Player")[0],n=r.find((function(e){return a===e.getId()}));c[t]=c[t].concat(n.get("Name"))})),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var G=function(e){var t=Object(u.g)(),a=t.gameId,c=t.questionId,s=Object(n.useState)({}),o=Object(i.a)(s,2),m=o[0],d=o[1],g=Object(n.useState)(null),E=Object(i.a)(g,2),b=E[0],p=E[1],v=new O({gameId:a});return Object(n.useEffect)((function(){v.getQuestion(c).then(p),function(e,t){return L.apply(this,arguments)}(v,c).then(d)}),[]),r.a.createElement(h.a,null,r.a.createElement(W,{className:"mb-4",result:m,question:b}),r.a.createElement(l.b,{to:"/games/".concat(encodeURI(a),"/questions/current")},r.a.createElement(f.a,{color:"primary"},"Next Question")))},T=function(e){var t=e.data,a=e.className;return r.a.createElement("div",{className:a},r.a.createElement("h2",{className:"mb-4"},t.get("Name")),r.a.createElement(I.a,null,["A","B","C","D"].map((function(e){return r.a.createElement(A.a,{sm:12,md:6,className:"mb-4"},r.a.createElement(F.a,null,r.a.createElement(U.a,null,r.a.createElement(_.a,null,r.a.createElement("strong",null,e)),r.a.createElement(J.a,null,t.get("Answer ".concat(e))))))}))))},H=function(e){var t=Object(u.g)().gameId,a=Object(n.useState)(null),c=Object(i.a)(a,2),s=c[0],o=c[1],m=new O({gameId:t});return Object(n.useEffect)((function(){m.startNextQuestion().then((function(){return m.getCurrentQuestion().then(o)}))}),[]),r.a.createElement(h.a,null,s?r.a.createElement("div",null,r.a.createElement(T,{data:s}),r.a.createElement(Q,{className:"mb-4",till:new Date(s.get("Finished At"))}),r.a.createElement(l.b,{to:"/games/".concat(encodeURI(t),"/results/").concat(s.getId())},r.a.createElement(f.a,{color:"primary"},"Show Result"))):r.a.createElement("div",null,"Loading..."))};var M=function(){return r.a.createElement(l.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(u.d,null,r.a.createElement(u.b,{path:"/games/:gameId/questions/current"},r.a.createElement(H,null)),r.a.createElement(u.b,{path:"/games/:gameId/results/:questionId"},r.a.createElement(G,null)),r.a.createElement(u.b,{path:"/games/:gameId/players/:playerId"},r.a.createElement(S,null)),r.a.createElement(u.b,{path:"/games/:gameId/join"},r.a.createElement(N,null)),r.a.createElement(u.b,{path:"/"},r.a.createElement(q,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[108,1,2]]]);
//# sourceMappingURL=main.d0193e8a.chunk.js.map