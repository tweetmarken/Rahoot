(this.webpackJsonpcahoots=this.webpackJsonpcahoots||[]).push([[0],{107:function(e,t,n){e.exports={hero_heading:"styles_hero_heading__1odbt"}},108:function(e,t,n){e.exports=n(257)},113:function(e,t,n){},115:function(e,t,n){},257:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(37),u=n.n(c),l=(n(113),n(22)),s=n(18),i=(n(114),n(115),n(10)),o=n.n(i),m=n(21),d=n(7),f=n(264),h=n(265),p=n(103),E=n(104),g=n(61),b=n.n(g),v=function(){function e(t){var n=t.gameId;Object(p.a)(this,e);var a=JSON.parse(atob(n)),r=a.apiKey,c=a.baseId;b.a.configure({endpointUrl:"https://api.airtable.com",apiKey:r}),this.game=b.a.base(c),this.getAllQuestions=this.getAllQuestions.bind(this),this.startNextQuestion=this.startNextQuestion.bind(this),this.getCurrentQuestion=this.getCurrentQuestion.bind(this)}return Object(E.a)(e,[{key:"addPlayer",value:function(e){return this.game("Players").create({Name:e}).then((function(e){return e.getId()}))}},{key:"addAnswer",value:function(){var e=Object(m.a)(o.a.mark((function e(t,n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCurrentQuestion();case 2:if(void 0!==(a=e.sent)){e.next=5;break}throw"Question has not started!";case 5:return e.abrupt("return",this.game("Answers").create({Answer:n,Player:[t],Question:[a.getId()]}).then((function(e){return{answer:e,question:a}})));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAllQuestions",value:function(){return this.game("Questions").select({sort:[{field:"Order",direction:"asc"}]}).all()}},{key:"getAnswers",value:function(){var e=Object(m.a)(o.a.mark((function e(t){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.game("Questions").find(t).then((function(e){return e.get("Answers")}));case 2:return void 0===(n=e.sent)&&(n=[]),a="OR(".concat(n.map((function(e){return'RECORD_ID()="'.concat(e,'"')})).join(","),")"),e.abrupt("return",this.game("Answers").select({filterByFormula:a}).all());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startNextQuestion",value:function(){var e=Object(m.a)(o.a.mark((function e(){var t,n,a,r,c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.game("Questions").select({filterByFormula:"{Finished At} = BLANK()",maxRecords:1,sort:[{field:"Order",direction:"asc"}]}).firstPage();case 2:if(t=e.sent,void 0!==(n=t[0])){e.next=6;break}return e.abrupt("return");case 6:return a=new Date(Date.now()+2e4),e.next=9,this.game("Questions").update([{id:n.id,fields:{"Finished At":"".concat(a.toISOString())}}]);case 9:return r=e.sent,c=Object(d.a)(r,2),c[0],u=c[1],e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentQuestion",value:function(){var e=Object(m.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.next=3,this.getAllQuestions().then((function(e){t=e.find((function(e){return(e.get("Finished At")?new Date(e.get("Finished At")):new Date+1)>new Date}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),w=n(258),y=n(259),O=n(260),j=n(261),N=n(262),A=n(263),x=function(e){var t=e.data,n=e.className;return r.a.createElement("div",{className:n},r.a.createElement("h2",{className:"mb-4"},t.get("Name")),r.a.createElement(w.a,null,["A","B","C","D"].map((function(e){return r.a.createElement(y.a,{sm:12,md:6,className:"mb-4"},r.a.createElement(O.a,null,r.a.createElement(j.a,null,r.a.createElement(N.a,null,r.a.createElement("strong",null,e)),r.a.createElement(A.a,null,t.get("Answer ".concat(e))))))}))))},I=function(e){var t=(e-Date.now())/1e3;return t>0?t:0},k=function(e){var t=e.till,n=e.className,c=Object(a.useState)(I(t)),u=Object(d.a)(c,2),l=u[0],s=u[1];return setTimeout((function(){return s(I(t))}),1e3),r.a.createElement("div",{className:n},l>0?Math.floor(l):0," seconds left")},Q=function(e){var t=e.result,n=e.className;return r.a.createElement("div",{className:n},Object.entries(t).map((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return r.a.createElement("div",null,n,": ",a.length)})))},C=function(e,t,n){e.startNextQuestion().then((function(){return e.getCurrentQuestion().then(t)})).then((function(){return n(null)}))};function S(){return(S=Object(m.a)(o.a.mark((function e(t,n,a){var r,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAnswers(n.getId());case 2:r=e.sent,c=r.reduce((function(e,t){var n=t.get("Answer");return null==e[n]&&(e[n]=[]),e[n]=e[n].concat(t.get("Player")),e}),{}),a(c);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=function(e){var t=Object(s.f)().gameId,n=Object(a.useState)(null),c=Object(d.a)(n,2),u=c[0],l=c[1],i=Object(a.useState)(null),o=Object(d.a)(i,2),m=o[0],p=o[1],E=new v({gameId:t});return Object(a.useEffect)((function(){E.getCurrentQuestion().then(l)}),[]),r.a.createElement(f.a,null,m?r.a.createElement("div",null,r.a.createElement(Q,{className:"mb-4",result:m}),r.a.createElement(h.a,{color:"primary",onClick:function(){return C(E,l,p)}},"Next Question")):u?r.a.createElement("div",null,r.a.createElement(x,{data:u}),r.a.createElement(k,{className:"mb-4",till:new Date(u.get("Finished At"))}),r.a.createElement(h.a,{onClick:function(){return function(e,t,n){return S.apply(this,arguments)}(E,u,p)},color:"primary"},"Show Result")):r.a.createElement(h.a,{onClick:function(){return C(E,l,p)},color:"primary"},"Start Game"))},K=n(266),P=n(267),B=n(268),R=n(270),F=function(e){var t=e.playerName,n=e.setPlayerName,a=e.joinGame;return r.a.createElement("div",null,r.a.createElement(K.a,null,r.a.createElement(P.a,null,"Name:"),r.a.createElement(B.a,{value:t,onChange:function(e){return n(e.target.value)}})),r.a.createElement(h.a,{color:"primary",onClick:a},"JOIN"))},_=function(e){var t=e.recordAnswer;return r.a.createElement(w.a,null,["A","B","C","D"].map((function(e){return r.a.createElement(y.a,{sm:12,md:6,className:"mb-4",key:e},r.a.createElement(h.a,{className:"w-100 h-100",onClick:function(){return t(e)}},r.a.createElement("strong",null,e)))})))},J=function(e){var t=Object(s.f)().gameId,n=Object(a.useState)(""),c=Object(d.a)(n,2),u=c[0],l=c[1],i=Object(a.useState)(""),o=Object(d.a)(i,2),m=o[0],h=o[1],p=Object(a.useState)(null),E=Object(d.a)(p,2),g=E[0],b=E[1],O=Object(a.useState)(""),j=Object(d.a)(O,2),N=j[0],A=j[1],x=new v({gameId:t});return r.a.createElement(f.a,{style:{maxWidth:"500px"}},m?r.a.createElement("div",null,r.a.createElement(w.a,{className:"mb-4"},r.a.createElement(y.a,{sm:12},r.a.createElement("h2",null,"Choose your answer:"))),r.a.createElement(_,{recordAnswer:function(e){x.addAnswer(m,e).then((function(e){var t=e.question;b(t),A("")})).catch((function(e){A(e),setTimeout((function(){return A("")}),5e3)}))}}),g?r.a.createElement(k,{till:new Date(g.get("Finished At"))}):null,N?r.a.createElement(R.a,{color:"danger"},N):null):r.a.createElement(F,{playerName:u,setPlayerName:l,joinGame:function(){x.addPlayer(u).then(h)}}))},U=n(269),G=n(107),W=n.n(G),L=function(e,t){return window.btoa(JSON.stringify({apiKey:e,baseId:t}))},q=function(e){var t=e.apiKey,n=e.baseId,a=L(t,n);return r.a.createElement(K.a,null,r.a.createElement(P.a,null,"Join URL:"),r.a.createElement(B.a,{disabled:!0,placeholder:"Enter an API Key and Base ID to generate the URL",value:t&&n?"".concat(window.location,"games/").concat(encodeURI(a),"/play"):null}))},T=function(e){var t=Object(a.useState)(""),n=Object(d.a)(t,2),c=n[0],u=n[1],s=Object(a.useState)(""),i=Object(d.a)(s,2),o=i[0],m=i[1],p=L(c,o);return r.a.createElement(f.a,{style:{maxWidth:"500px"}},r.a.createElement("h1",{className:W.a.hero_heading},"Cahoots!"),r.a.createElement(U.a,{className:"mb-5"},r.a.createElement(K.a,null,r.a.createElement(P.a,{for:"apiKey"},"API Key:"),r.a.createElement(B.a,{id:"apiKey",value:c,onChange:function(e){return u(e.target.value)}})),r.a.createElement(K.a,null,r.a.createElement(P.a,null,"Base ID:"),r.a.createElement(B.a,{value:o,onChange:function(e){return m(e.target.value)}})),r.a.createElement(q,{apiKey:c,baseId:o})),r.a.createElement(l.b,{to:"/games/".concat(encodeURI(p),"/host")},r.a.createElement(h.a,{color:"primary"},"Host Game")))};var H=function(){return r.a.createElement(l.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/games/:gameId/host"},r.a.createElement(D,null)),r.a.createElement(s.a,{path:"/games/:gameId/play"},r.a.createElement(J,null)),r.a.createElement(s.a,{path:"/"},r.a.createElement(T,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(r.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[108,1,2]]]);
//# sourceMappingURL=main.79a49581.chunk.js.map