(this.webpackJsonpcahoots=this.webpackJsonpcahoots||[]).push([[0],{103:function(e,t,n){},104:function(e,t,n){},239:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),u=n(93),c=n.n(u),i=(n(103),n(18)),l=n(13),o=(n(104),n(5)),s=n.n(o),m=n(16),d=n(3),f=n(94),h=n(95),v=n(55),g=n.n(v),b=function(){function e(t){var n=t.gameId;Object(f.a)(this,e);var a=JSON.parse(atob(n)),r=a.apiKey,u=a.baseId;g.a.configure({endpointUrl:"https://api.airtable.com",apiKey:r}),this.game=g.a.base(u),this.getAllQuestions=this.getAllQuestions.bind(this),this.startNextQuestion=this.startNextQuestion.bind(this),this.getCurrentQuestion=this.getCurrentQuestion.bind(this)}return Object(h.a)(e,[{key:"addPlayer",value:function(e){return this.game("Players").create({Name:e}).then((function(e){return e.getId()}))}},{key:"addAnswer",value:function(){var e=Object(m.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCurrentQuestion();case 2:return a=e.sent,e.abrupt("return",this.game("Answers").create({Answer:n,Player:[t],Question:[a.getId()]}).then((function(e){return{answer:e,question:a}})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAllQuestions",value:function(){return this.game("Questions").select({sort:[{field:"Order",direction:"asc"}]}).all()}},{key:"getAnswers",value:function(){var e=Object(m.a)(s.a.mark((function e(t){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.game("Questions").find(t).then((function(e){return e.get("Answers")}));case 2:return void 0===(n=e.sent)&&(n=[]),a="OR(".concat(n.map((function(e){return'RECORD_ID()="'.concat(e,'"')})).join(","),")"),e.abrupt("return",this.game("Answers").select({filterByFormula:a}).all());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startNextQuestion",value:function(){var e=Object(m.a)(s.a.mark((function e(){var t,n,a,r,u,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.game("Questions").select({filterByFormula:"{Finished At} = BLANK()",maxRecords:1,sort:[{field:"Order",direction:"asc"}]}).firstPage();case 2:if(t=e.sent,void 0!==(n=t[0])){e.next=6;break}return e.abrupt("return");case 6:return a=new Date(Date.now()+2e4),e.next=9,this.game("Questions").update([{id:n.id,fields:{"Finished At":"".concat(a.toISOString())}}]);case 9:return r=e.sent,u=Object(d.a)(r,2),u[0],c=u[1],e.abrupt("return",c);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentQuestion",value:function(){var e=Object(m.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,e.next=3,this.getAllQuestions().then((function(e){t=e.find((function(e){return(e.get("Finished At")?new Date(e.get("Finished At")):new Date+1)>new Date}))}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),p=function(e){var t=e.data;return r.a.createElement("div",null,r.a.createElement("div",null,t.get("Name")),r.a.createElement("ol",null,r.a.createElement("li",null,t.get("Answer A")),r.a.createElement("li",null,t.get("Answer B")),r.a.createElement("li",null,t.get("Answer C")),r.a.createElement("li",null,t.get("Answer D"))))},E=function(e){var t=(e-Date.now())/1e3;return t>0?t:0},w=function(e){var t=e.till,n=Object(a.useState)(E(t)),u=Object(d.a)(n,2),c=u[0],i=u[1];return setTimeout((function(){return i(E(t))}),1e3),r.a.createElement("div",null,c>0?Math.floor(c):0," seconds left")},O=function(e){var t=e.result;return r.a.createElement("div",null,Object.entries(t).map((function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return r.a.createElement("div",null,n,": ",a.length)})))},j=function(e,t,n){e.startNextQuestion().then((function(){return e.getCurrentQuestion().then(t)})).then((function(){return n(null)}))};function A(){return(A=Object(m.a)(s.a.mark((function e(t,n,a){var r,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAnswers(n.getId());case 2:r=e.sent,u=r.reduce((function(e,t){var n=t.get("Answer");return null==e[n]&&(e[n]=[]),e[n]=e[n].concat(t.get("Player")),e}),{}),a(u);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=function(e){var t=Object(l.f)().gameId,n=Object(a.useState)(null),u=Object(d.a)(n,2),c=u[0],i=u[1],o=Object(a.useState)(null),s=Object(d.a)(o,2),m=s[0],f=s[1],h=new b({gameId:t});return Object(a.useEffect)((function(){h.getCurrentQuestion().then(i)}),[]),r.a.createElement("div",null,m?r.a.createElement("div",null,r.a.createElement(O,{result:m}),r.a.createElement("button",{onClick:function(){return j(h,i,f)}},"Next Question")):c?r.a.createElement("div",null,r.a.createElement(p,{data:c}),r.a.createElement(w,{till:new Date(c.get("Finished At"))}),r.a.createElement("button",{onClick:function(){return function(e,t,n){return A.apply(this,arguments)}(h,c,f)}},"Show Result")):r.a.createElement("button",{onClick:function(){return j(h,i,f)}},"Start Game"))},k=function(e){var t=e.playerName,n=e.setPlayerName,a=e.joinGame;return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("label",null,"Name: ",r.a.createElement("input",{value:t,onChange:function(e){return n(e.target.value)}}))),r.a.createElement("button",{onClick:a},"JOIN"))},C=function(e){var t=Object(l.f)().gameId,n=Object(a.useState)(""),u=Object(d.a)(n,2),c=u[0],i=u[1],o=Object(a.useState)(""),s=Object(d.a)(o,2),m=s[0],f=s[1],h=Object(a.useState)(null),v=Object(d.a)(h,2),g=v[0],p=v[1],E=new b({gameId:t});return m?r.a.createElement("div",null,g?r.a.createElement(w,{till:new Date(g.get("Finished At"))}):null,r.a.createElement("button",{onClick:function(){return E.addAnswer(m,"A").then((function(e){var t=e.question;return p(t)}))}},"A"),r.a.createElement("button",{onClick:function(){return E.addAnswer(m,"B")}},"B"),r.a.createElement("button",{onClick:function(){return E.addAnswer(m,"C")}},"C"),r.a.createElement("button",{onClick:function(){return E.addAnswer(m,"D")}},"D")):r.a.createElement(k,{playerName:c,setPlayerName:i,joinGame:function(){E.addPlayer(c).then(f)}})},I=function(e){var t=Object(a.useState)(""),n=Object(d.a)(t,2),u=n[0],c=n[1],l=Object(a.useState)(""),o=Object(d.a)(l,2),s=o[0],m=o[1],f=window.btoa(JSON.stringify({apiKey:u,baseId:s}));return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("label",null,"API Key:",r.a.createElement("input",{value:u,onChange:function(e){return c(e.target.value)}})),r.a.createElement("label",null,"Base ID:",r.a.createElement("input",{value:s,onChange:function(e){return m(e.target.value)}}))),r.a.createElement(i.b,{to:"/games/".concat(encodeURI(f),"/host")},r.a.createElement("button",null,"Host Game")),r.a.createElement("div",null,"Join URL:","".concat(window.location,"games/").concat(encodeURI(f),"/join")))};var Q=function(){return r.a.createElement(i.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"/games/:gameId/host"},r.a.createElement(y,null)),r.a.createElement(l.a,{path:"/games/:gameId/play"},r.a.createElement(C,null)),r.a.createElement(l.a,{path:"/"},r.a.createElement(I,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},98:function(e,t,n){e.exports=n(239)}},[[98,1,2]]]);
//# sourceMappingURL=main.b89c7934.chunk.js.map